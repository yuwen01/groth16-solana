# Example

This example demonstrates how to use the `sp1-solana` crate to verify a proof generated by the `SP1` library on Solana.

## Overview: Script

This script will load a serialized [`SP1ProofWithPublicValues`](https://docs.rs/sp1-sdk/2.0.0/sp1_sdk/proof/struct.SP1ProofWithPublicValues.html)
from the pre-generated proof [`fibonacci_proof.bin`](./proofs/fibonacci_proof.bin). This is a SP1 Groth16 proof that
proves that the 20th fibonacci number is 6765.

The loaded `SP1ProofWithPublicValues` will be serialized into a `SP1ProofFixture`, and written to
[`proof-fixtures/fibonacci_fixture.bin`](./proof-fixtures/fibonacci_fixture.bin). The `SP1ProofFixture` can easily be borsh serialized and 
deserialized, and is used to verify the proof. 

Here is a snippet of the script that demonstrates the above logic. 

```rust
fn main() {
    // Setup logging for the application.
    utils::setup_logger();

    // Where to save / load the proof from.
    let proof_file = "../proofs/fibonacci_proof.bin";

    // Load the proof from the file, and convert it to a fixture.
    let sp1_proof_with_public_values = SP1ProofWithPublicValues::load(&proof_file).unwrap();
    let fixture = SP1ProofFixture::from(sp1_proof_with_public_values);
    let fixture_file = "../proof-fixtures/fibonacci_fixture.bin";
    fixture.save(&fixture_file).unwrap();

    // Verify the proof.
    verify_proof_fixture(&fixture, GROTH16_VK_BYTES).expect("Proof verification failed");
    println!("Successfully verified proof for the program!")
}
```

### Running the script

Run the following commands. 

```shell
cd script
RUST_LOG=info cargo run --release
```

## Overview: Solana Program

The code in [`solana/program`](./solana/program) is a simple Solana program that verifies a `SP1ProofFixture` using the `sp1-solana` crate.
It costs roughly 230,000 compute units. Here is an excerpt from the program that demonstrates how to load a `SP1ProofFixture` and prepare to verify it. 

```ts
// Helper function to read the proof fixture from the provided path
function createVerifyInstruction(pubkey: PublicKey, proof_path: string): TransactionInstruction {
  const fs = require('fs');
  const data = fs.readFileSync(proof_path);
  return new TransactionInstruction({
    programId: PROGRAM_ID,
    keys: [{ pubkey: pubkey, isSigner: true, isWritable: true }],
    data: data,
  });
}
```

### Running the solana program

Running the solana program and tests requires the following

* [PNPM](https://pnpm.io/installation)
* [yarn](https://yarnpkg.com/getting-started/install)
* [Solana CLI](https://docs.solana.com/cli/install-solana-cli)
  * Make sure to install the edge version. Run the following: 
  ```shell
  sh -c "$(curl -sSfL https://release.anza.xyz/edge/install)"
  ```
* [Rust](https://www.rust-lang.org/tools/install)

```shell
cd solana
pnpm install
yarn build-and-test
```
